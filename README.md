# 立方体折叠测试游戏 - 核心架构要求

## 系统核心要求

本项目实现了一个基于**穷举法**和**位置邻接关系**的立方体折叠测试游戏。所有核心逻辑严格按照以下架构要求编写：

### 1. 立方体8个顶点定义（穷举法）

**要求：** 每个展开图类型都有独立的8个顶点定义，每个顶点包含三个面的位置索引，且这三个面按顺序排列，**不允许随机改变排列顺序**。

**实现位置：** `js/adjacency.js` 中的顶点定义：

```javascript
// 十字形展开图的立方体顶点定义
const CROSS_NET_VERTICES = [
    { vertex: 1, positions: [0, 1, 2], description: "顶部-左侧-中心" },
    { vertex: 2, positions: [0, 2, 3], description: "顶部-中心-右侧" },
    // ... 8个顶点，每个顶点的positions顺序固定不变
];

// 每种展开图类型（十字形、T形、Z形、L形）都有独立的8个顶点定义
const NET_VERTICES_MAP = {
    '十字形': CROSS_NET_VERTICES,
    'T形': T_NET_VERTICES,
    'Z形': Z_NET_VERTICES,
    'L形': L_NET_VERTICES
};
```

### 2. 每个立方体需要有独立的三面组合列表

**要求：** 每种展开图类型生成独立的有效三面组合列表，基于其8个顶点定义进行穷举。

**实现原理：**
- 使用 `generateAllValidThreeFaceCombinations()` 为每种展开图类型生成独立的有效组合列表
- 基于该展开图的8个顶点定义进行穷举，生成所有可能的三面排列 
- 每个组合包含 `{front, left, top}` 三个面的编号

### 3. 正确答案生成：从有效组合列表中随机选择一个

**要求：** 正确答案必须从预生成的有效三面组合列表中随机选取。

**实现函数：** `generateCorrectAnswerFromValidList()`

```javascript
function generateCorrectAnswerFromValidList(netFaces) {
    const validCombinations = generateAllValidThreeFaceCombinations(netFaces);
    
    if (validCombinations.length === 0) {
        console.error('没有找到有效的三面组合');
        return null;
    }
    
    // 随机选择一个有效组合
    const selectedIndex = Math.floor(Math.random() * validCombinations.length);
    const selected = validCombinations[selectedIndex];
    
    return selected;
}
```

### 4. 错误答案生成：保证生成不在有效列表中的组合

**要求：** 错误答案必须确保不在有效组合列表中，通过随机生成并验证排除的方式实现。

**实现函数：** `generateWrongAnswerNotInList()`

```javascript
function generateWrongAnswerNotInList(validCombinations, netFaces) {
    const faceNumbers = netFaces.map(f => f.number);
    const maxAttempts = 100;
    let attempts = 0;
    
    while (attempts < maxAttempts) {
        // 随机生成一个三面组合
        const shuffled = [...faceNumbers].sort(() => Math.random() - 0.5);
        const candidate = {
            front: shuffled[0],
            left: shuffled[1],
            top: shuffled[2]
        };
        
        // 检查是否与有效组合重复
        const isDuplicate = validCombinations.some(valid => 
            valid.front === candidate.front && 
            valid.left === candidate.left && 
            valid.top === candidate.top
        );
        
        if (!isDuplicate) {
            return candidate;
        }
        
        attempts++;
    }
    
    // 备用策略...
}
```

## 核心架构特点

### 位置基础设计（Position-Based Architecture）

- **邻接关系**：基于展开图中的位置索引（0-5），而非面的数字（1-6）
- **顶点定义**：每个顶点通过位置索引三元组定义，如 `[0, 1, 2]` 表示位置0、1、2的面可以在该顶点相遇
- **面编号随机**：面的数字（1-6）随机分配到位置，但几何关系基于位置不变

### 穷举法验证系统

- **完全枚举**：预先定义所有8个立方体顶点，每个顶点指定能相遇的3个面
- **严格验证**：所有三面组合必须对应真实的立方体顶点，确保几何准确性
- **无启发式**：不使用近似或启发式算法，完全基于预定义的几何关系

### 多展开图支持

支持4种标准展开图类型：
- **十字形**：最常见的展开图
- **T形**：T字形状展开图  
- **Z形**：Z字形状展开图
- **L形**：L字形状展开图

每种类型都有：
- 独立的位置邻接关系表
- 独立的8个顶点定义
- 独立生成的有效三面组合列表

## 文件结构

- `js/adjacency.js`：位置邻接关系、8顶点定义、穷举法验证核心
- `js/cube.js`：展开图生成、答案生成、游戏逻辑
- `js/main.js`：UI控制、游戏流程管理
- `index.html`：主游戏界面
- 测试文件：`test-*.html` 用于验证核心逻辑

## 重要说明

1. **严禁修改顶点定义的顺序**：每个顶点的positions数组顺序是固定的，基于几何关系确定
2. **答案生成必须遵循规则**：正确答案从有效列表选取，错误答案确保不在有效列表中
3. **位置优先原则**：所有几何验证基于位置关系，面编号仅用于显示
4. **独立性原则**：每种展开图类型的验证逻辑完全独立，互不干扰

这个架构确保了游戏的数学准确性和可扩展性，同时保持了代码的清晰性和可维护性。

---

## 项目简介
一个基于HTML/CSS/JavaScript的网页小游戏，测试玩家的空间想象能力。玩家需要根据立方体的展开图，从四个选项中选择正确的折叠后立方体。

## 游戏规则
1. **展示题目**：屏幕上方显示一个立方体展开图，六个面标注数字1-6
2. **选择答案**：屏幕下方提供4个立方体选项，每个显示三个可见面
3. **判断结果**：玩家选择后系统给出正确/错误反馈
4. **唯一正解**：四个选项中只有一个是正确答案

## 技术特点

### 展开图类型
- 支持正方体的11种标准展开图形状
- 每个面用数字1-6标识，便于识别和验证

### 邻接关系算法 (基于位置的设计)
使用基于展开图位置索引的邻接关系表，确保逻辑准确性：
```javascript
// 十字形展开图的位置邻接关系
const CROSS_POSITION_ADJACENCY = {
  0: [1, 2, 3, 4],    // 顶部位置邻接左侧、中心、右侧、最右
  1: [0, 2, 4, 5],    // 左侧位置邻接顶部、中心、最右、底部
  2: [0, 1, 3, 5],    // 中心位置邻接顶部、左侧、右侧、底部
  3: [0, 2, 4, 5],    // 右侧位置邻接顶部、中心、最右、底部
  4: [0, 1, 3, 5],    // 最右位置邻接顶部、左侧、右侧、底部
  5: [1, 2, 3, 4]     // 底部位置邻接左侧、中心、右侧、最右
};
```

**重要改进**：邻接关系现在基于展开图中的位置而非面上的数字，解决了随机数字分配与邻接验证的逻辑冲突问题。

### 核心功能模块
1. **展开图生成器** - 随机生成11种展开图之一，支持随机数字分配
2. **位置邻接关系验证器** - `isPositionAdjacent(pos1, pos2)` 和 `isAdjacent(face1, face2, netFaces)` 函数
3. **六面立方体验证器** - `isValidCubeFaces()` 函数支持完整六面验证，包含对立面关系检查
4. **立方体选项生成器** - 生成1个正确选项和3个干扰选项，基于真实几何关系
5. **答案验证系统** - 检查玩家选择是否正确，包含空间一致性验证
6. **多展开图支持** - 支持十字形、T形、Z形、L形等不同展开图类型

## 文件结构
```
cube-folding/
├── README.md                         # 项目说明文档
├── index.html                        # 主游戏页面
├── 11 style.jpeg                     # 11种展开图参考图片
├── css/
│   └── style.css                     # 样式文件
├── js/
│   ├── main.js                       # 主游戏逻辑
│   ├── cube.js                       # 立方体相关函数 (支持六面验证)
│   └── adjacency.js                  # 位置邻接关系处理
├── assets/                           # 资源目录
├── 测试工具/
│   ├── test-six-faces.html           # 六面立方体验证系统测试 (推荐)
│   ├── test-position-adjacency.html  # 位置邻接关系系统测试
│   ├── final-verification.html       # 最终系统验证
│   └── multi-adjacency-test.html     # 统一测试验证平台 (历史参考)
└── .cursorrules                      # 项目规则配置
```

### 重要文件说明
- **js/adjacency.js** - 基于位置的邻接关系系统
- **js/cube.js** - 立方体验证核心，支持三面和六面验证
- **test-six-faces.html** - 六面立方体验证系统专用测试工具（推荐使用）
- **test-position-adjacency.html** - 位置邻接关系系统测试
- **final-verification.html** - 全面系统验证
- **multi-adjacency-test.html** - 历史统一测试平台（保留参考）

## 架构设计

### 基于位置的邻接关系系统
- **位置索引**：邻接关系基于展开图中的位置索引（0-5）而非面上的数字
- **几何准确性**：每种展开图类型都有对应的位置邻接关系表，基于真实立方体几何
- **随机兼容性**：支持随机数字分配，不影响邻接逻辑的正确性
- **向后兼容性**：保持原有API，同时提供新的位置基础函数

### 重构历程
**问题发现**：原设计中邻接关系基于面编号定义，但随机数字分配破坏了这种假设，导致验证逻辑矛盾。

**解决方案**：重新设计为基于位置的邻接关系系统：
1. 邻接关系基于展开图中的位置关系定义
2. 随机数字分配不影响位置邻接逻辑
3. 验证基于真实的立方体几何关系

## 开发原则
- **简单易懂**：使用纯HTML/CSS/JavaScript，适合初学者理解
- **几何准确**：基于真实立方体几何关系，确保逻辑正确性
- **完整测试**：包含多层次测试系统，覆盖边界条件和错误情况
- **可扩展性**：支持多种展开图类型，易于添加新的展开图
- **苹果美学**：界面设计遵循简约现代的视觉风格

## MVP功能清单
- [x] 项目规划和文档
- [x] HTML页面结构搭建
- [x] CSS样式设计（苹果风格）
- [x] 邻接关系核心算法实现
- [x] 展开图生成逻辑
- [x] 立方体选项生成算法
- [x] 游戏交互逻辑
- [x] 答案验证和反馈系统
- [x] 测试用例验证

## 已完成的核心功能
- ✅ **多展开图支持**: 实现了十字形、T形、Z形、L形四种标准展开图
- ✅ **独立邻接关系**: 每种展开图都有专属的邻接关系定义
- ✅ **3D立方体渲染**: 使用CSS 3D transforms实现立方体可视化
- ✅ **颜色系统**: 6种渐变色彩区分不同面，支持展开图和立方体一致显示
- ✅ **游戏逻辑**: 完整的题目生成、选项生成、答案验证流程
- ✅ **响应式UI**: 苹果风格的现代化界面设计
- ✅ **调试工具**: 多个测试页面用于验证邻接关系和游戏逻辑

## 技术特色
- **动态邻接切换**: 根据展开图类型自动设置对应的邻接关系
- **严格几何验证**: 确保每个面有4个邻接面和1个相对面
- **可视化展开图**: 实时显示当前展开图的形状和面编号
- **完整测试体系**: 包含对称性、数量、结构等多维度验证

## 已解决的技术挑战
- ✅ **邻接关系对称性问题**: 原验证逻辑要求完全对称，已理解不同展开图有各自的几何特性
- ✅ **立方体角度显示**: 优化了CSS 3D旋转角度，确保三个面（前、左、上）清晰可见
- ✅ **颜色映射一致性**: 解决了展开图与3D立方体颜色不匹配的问题
- ✅ **数字重复问题**: 修正了立方体选项生成逻辑，确保每个可见面数字唯一
- ✅ **多展开图邻接关系**: 成功为四种展开图定义了各自正确的邻接关系表

## 版本历史

### v2.1 - 六面立方体验证系统 (当前版本)
- **重大升级**：从三面验证扩展到完整的六面立方体验证
- 实现完整立方体的空间一致性检查（front, back, left, right, top, bottom）
- 添加对立面关系验证（基于标准骰子规则：对立面之和为7）
- 支持从三面配置推导完整六面配置的算法
- 保持向后兼容性，同时支持新的六面验证API
- 添加专门的六面测试工具 `test-six-faces.html`

### v2.0 - 基于位置的邻接关系系统
- 重构邻接关系系统，解决随机数字分配与验证逻辑冲突问题
- 实现基于展开图位置索引的邻接关系定义
- 支持多种展开图类型（十字形、T形、Z形、L形）
- 添加全面的测试验证系统
- 保持向后兼容性，同时提供新的API

### v1.0 - 初始版本
- 基本的立方体折叠游戏功能
- 基于面编号的邻接关系设计
- 支持十字形展开图
- 基础的测试框架

## 使用说明

### 开发者
1. 直接打开 `index.html` 开始游戏
2. 使用 `test-six-faces.html` 测试六面立方体验证功能（推荐）
3. 使用 `test-position-adjacency.html` 进行系统测试
4. 使用 `final-verification.html` 进行全面验证

### 扩展新展开图
1. 在 `js/cube.js` 中的 `CUBE_NETS` 数组中添加新的展开图模板
2. 在 `js/adjacency.js` 中定义对应的位置邻接关系
3. 在 `POSITION_ADJACENCY_MAP` 中添加映射关系
4. 使用测试工具验证新添加的展开图

## 测试与验证

### 测试工具
项目提供多层次的测试工具来验证系统的正确性：

1. **test-six-faces.html** - 六面立方体验证系统测试（推荐）
   - 测试有效和无效的六面配置
   - 验证对立面关系和邻接关系
   - 测试三面兼容性和立方体生成功能

2. **test-position-adjacency.html** - 位置邻接关系系统测试
   - 验证基于位置的邻接关系逻辑
   - 测试多种展开图类型的邻接关系

3. **final-verification.html** - 全面系统验证
   - 运行完整的系统测试套件
   - 验证所有展开图类型的正确性

4. **multi-adjacency-test.html** - 历史统一测试平台
   - 保留作为历史参考和完整功能展示
   - 提供可视化展开图布局和交互式验证

### 推荐测试流程
1. 首先运行 `test-six-faces.html` 验证核心六面功能
2. 使用 `test-position-adjacency.html` 测试邻接关系
3. 最后运行 `final-verification.html` 进行全面验证

## 后续优化方向
1. **扩展展开图类型** - 添加剩余7种标准立方体展开图
2. **多难度模式** - 根据展开图复杂度分级
3. **计分系统** - 记录正确率、用时和连续答对次数
4. **动画效果** - 立方体折叠/展开过程可视化
5. **题库系统** - 预设题目库和随机生成算法
6. **移动端优化** - 触摸交互和响应式布局增强

## 技术栈
- **前端**：HTML5, CSS3, Vanilla JavaScript
- **设计**：SVG图形, CSS Grid/Flexbox
- **兼容性**：现代浏览器 (Chrome, Firefox, Safari, Edge)

---
*项目目标：为初中生用户提供一个简单有趣的空间思维训练工具* 